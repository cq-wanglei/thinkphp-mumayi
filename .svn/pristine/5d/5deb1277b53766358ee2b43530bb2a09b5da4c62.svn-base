<?php

/**
* 
*/
class db{
	//链接数据库句柄
	private $con;
	/*
		初始化链接数据库
	*/
	public function __construct(){
		$this->con = mysqli_connect('iemnqynhkccu.mysql.sae.sina.com.cn','root','w820962264','fanzhan',10375) or die("连接失败！！") ;
		$sql = "set names utf8";
		$res = mysqli_query($this->con,$sql);
	}
	/*
		执行数据库
	*/
	public function my_exec($sql){
		$res = mysqli_query($this->con,$sql);
		return $res;
	}
	/*
		查询域名是否存在
	*/
	public function yuming($domian){
		$domian = addslashes($domian);
		$sql = "select id from domian where domian = '$domian'";
		$res = $this->my_exec($sql);
		if ($res->num_rows > 0) {
			$row = mysqli_fetch_row($res);
			echo $rows[0];
			return $row[0];
		}else{
			return 0;
		}
	}
	
	/*
		获取关键词
	*/
	public function keyword($k){
		$sql = "select keyword from domian where id = $k";
		$res = $this->my_exec($sql);
		if ($res->num_rows > 0) {
			$row = mysqli_fetch_row($res);
			return $row[0];
		}else{
			return '';
		}
	}
	/*
		如果文章存在，取出文章！如果文章不存在，创建文章
	*/
	public function check($keyword){
		$keyword = addslashes($keyword);
		$sql = "select contents,relation from page where keyword = '$keyword'";
		$res = $this->my_exec($sql); 
		if ($res->num_rows > 0) {
			//文章存在
			$temps = mysqli_fetch_row($res);
			$data = araay();
			$data['contents'] = $temps[0];
			$data['relation'] = $temps[2];
			return $data;
		}else{
			//文章不存在
			$sql1 = "select content from contents order by rand() limit 10";
			$res1 = $this->my_exec($sql1);
			$juzi = array();
			while ($row = mysqli_fetch_row($res1)) {
				print_r($row[0]);
				preg_match_all("/(。)|(，)|(,)|(!)|(！)|(!)|(；)|(:)|(?)/", $row[0], $temp);
				print_r($temp);die();
				array_push($juzi, $temp);
			}
			print_r($juzi);
		}
	}

	/*
		结束断开数据库
	*/
	public function _destruct(){
		mysqli_close($con);
	}


}









?>